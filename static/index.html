<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>量子庵 : 演算する彼岸∽二〇卌五</title>
    
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23D4AF37' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='12' cy='12' r='10'/%3E%3Cline x1='2' y1='12' x2='22' y2='12'/%3E%3Cpath d='M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z'/%3E%3Cpath d='M2.93 8.8h18.14'/%3E%3Cpath d='M2.93 15.2h18.14'/%3E%3C/svg%3E">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Shippori+Mincho:wght@400;500;700&display=swap" rel="stylesheet">
    
    <style>
        /* === 共通設定 === */
        * { -webkit-user-select: none; user-select: none; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        input, textarea { -webkit-user-select: text !important; user-select: text !important; outline: none; }
        
        :root {
            --bg-color: #000000;
            --text-color: #ffffff;
            --font-main: 'Shippori Mincho', serif;
            --rand-x: 50%;
            --rand-y: 50%;
        }


        /* 背景動画のスタイル */
        #bg-video {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover; /* 画面いっぱいに広げ、アスペクト比を維持して切り抜き */
            z-index: -2; /* コンテンツより後ろに配置 */
        }

        /* 動画の上に被せる半透明のオーバーレイ（文字の可読性を上げるため） */
        .video-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.4); /* 0.4の部分を大きくすると暗くなります */
            z-index: -1;
        }

        /* 既存のbodyの背景設定を調整 */
        body {
            background-color: #000; /* 動画が読み込まれるまでの待機色 */
            color: var(--text-color);
            font-family: var(--font-main); margin: 0; padding: 0;
            min-height: 100vh; display: flex; flex-direction: column; align-items: center; overflow-x: hidden;
            touch-action: manipulation; /* ダブルタップズームを抑制 */
        }
        body.no-scroll { overflow: hidden !important; height: 100vh; touch-action: none; }

        /* 背景動画 */
        /* #bg-video { position: fixed; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; z-index: -2; }
        .video-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.75); z-index: -1; } */

        /* マーブリング設定 */
        .text-marbling {
            background-image: url('/static/texture.jpg');
            background-size: 1000%;
            background-position: var(--rand-x) var(--rand-y);
            -webkit-background-clip: text; background-clip: text; color: transparent;
        }

        /* アニメーション */
        .dissolve-out { animation: fadeOut 0.8s ease forwards; pointer-events: none; }
        .dissolve-in { display: block !important; animation: fadeIn 0.8s ease forwards; }
        @keyframes fadeOut { from { opacity: 1; filter: blur(0); } to { opacity: 0; filter: blur(10px); } }
        @keyframes fadeIn { from { opacity: 0; filter: blur(10px); } to { opacity: 1; filter: blur(0); } }

        .container { width: 100%; max-width: 600px; padding: 20px; padding-top: 100px; padding-bottom: 120px; position: relative; z-index: 1; }

        /* ヘッダー */
        .header-fixed {
            position: fixed; top: 0; left: 0; width: 100%; height: 80px;
            background: rgba(0, 0, 0, 0.6); backdrop-filter: blur(10px);
            z-index: 9999;
            display: grid; grid-template-columns: 1fr auto 1fr; align-items: center; padding: 0 20px;
        }
        .header-title { font-size: 1.1rem; letter-spacing: 0.1em; font-weight: 500; margin: 0; }
        .header-right { display: flex; gap: 15px; align-items: center; justify-self: end; }

        .lang-switch-wrapper { display: flex; border: 1px solid #fff; border-radius: 20px; overflow: hidden; font-size: 0.7rem; cursor: pointer; }
        .lang-part { padding: 4px 14px; color: #fff; transition: color 0.3s; }
        .lang-part.active {
            background-image: url('/static/texture.jpg'); 
            background-size: 1000%;
            background-position: var(--rand-x) var(--rand-y);
            color: #000; font-weight: bold;
        }

        /* バーガーメニュー */
        .hamburger { width: 30px; height: 20px; cursor: pointer; position: relative; z-index: 10000; display: flex; flex-direction: column; justify-content: space-between; }
        .hamburger span { display: block; width: 100%; height: 1px; background: #fff; transition: 0.4s; }
        .hamburger.open span:nth-child(1) { transform: rotate(45deg) translate(6px, 7px); }
        .hamburger.open span:nth-child(2) { opacity: 0; }
        .hamburger.open span:nth-child(3) { transform: rotate(-45deg) translate(6px, -7px); }

        #menu-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.98); z-index: 9990; 
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            opacity: 0; pointer-events: none; transition: 0.5s;
        }
        #menu-overlay.show { opacity: 1; pointer-events: auto; }
        .menu-list { list-style: none; padding: 0; text-align: center; }
        .menu-list li { margin: 25px 0; }
        .menu-item { font-size: 1.6rem; color: #fff; text-decoration: none; letter-spacing: 0.2em; cursor: pointer; transition: 0.2s; }
        .menu-item.selected {
            background-image: url('/static/texture.jpg');
            background-size: 1000%; -webkit-background-clip: text; color: transparent; font-weight: bold;
        }
        .menu-sub { font-size: 0.7rem; color: #888; display: block; margin-top: 5px; }
        
        /* コンテンツオーバーレイ */
        #content-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 5000; 
            display: none; flex-direction: column; overflow-y: auto;
            padding-top: 80px; padding-bottom: 100px;
        }
        #content-overlay.show { display: flex; }
        .content-body { padding: 0 25px 40px; max-width: 650px; margin: 0 auto; color: #ddd; line-height: 2.3; text-align: justify; }
        .content-body h3 { text-align: center; font-size: 1.8rem; margin-bottom: 60px; }
        .content-body h4 { 
            color: #fff; border-left: 2px solid #fff; padding-left: 15px; 
            margin-top: 60px; margin-bottom: 25px; font-weight: bold; font-size: 1.1rem;
        }

        .close-content-btn {
            position: fixed; bottom: 40px; left: 50%; transform: translateX(-50%);
            background: none; border: none; color: #fff; font-size: 3rem; 
            font-weight: 100; cursor: pointer; z-index: 5010; opacity: 0.8;
        }

        /* ボタン */
        .btn-entry {
            position: relative;
            display: block; width: 100%; max-width: 280px; margin: 60px auto; padding: 22px;
            font-family: var(--font-main); font-size: 1.2rem; letter-spacing: 0.3em;
            background: transparent; 
            color: #fff; 
            border: 1px solid #fff; 
            cursor: pointer; 
            transition: transform 0.1s;
            z-index: 1;
        }
        .btn-entry:active, .btn-entry.clicked {
            border: 2px solid transparent; border-image: url('/static/texture.jpg') 30 stretch;
            background-image: url('/static/texture.jpg'); background-size: 1000%; background-position: var(--rand-x) var(--rand-y);
            -webkit-background-clip: text; background-clip: text; color: transparent;
            transform: scale(0.98);
        }

        .clean-input { width: 100%; background: transparent; border: none; border-bottom: 1px solid #444; color: #fff; padding: 12px 0; font-size: 1.1rem; font-family: var(--font-main); border-radius: 0; }
        .clean-input:focus { border-bottom: 1px solid #fff; }
        
        .clean-textarea {
            width: 100%; background: rgba(255,255,255,0.05); border: 1px solid #444; color: #fff;
            padding: 15px; font-size: 1rem; font-family: var(--font-main); resize: none; border-radius: 0; line-height: 1.8;
        }
        .clean-textarea:focus { border-color: #fff; background: rgba(255,255,255,0.1); }
        .clean-textarea::placeholder, .clean-input::placeholder, .color-picker-trigger {
            color: #666; font-size: 0.8rem;
        }

        .color-picker-trigger {
            width: 100%; padding: 12px 0;
            border-bottom: 1px solid #444;
            cursor: pointer; text-align: center;
        }
        .color-picker-trigger.selected { color: #fff; text-shadow: 0 0 5px rgba(255,255,255,0.5); }

        #color-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); z-index: 9995;
            display: none; flex-direction: column; align-items: center; justify-content: center;
        }
        #color-modal.show { display: flex; animation: fadeIn 0.3s; }
        
        /* --- カラーピッカー刷新用スタイル --- */
        .color-picker-wrapper {
            position: relative; width: 280px; height: 280px; margin-bottom: 30px;
            user-select: none; -webkit-user-drag: none;
        }
        .color-hue-ring {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            border-radius: 50%;
            background: conic-gradient(red, yellow, lime, aqua, blue, magenta, red);
            -webkit-mask: radial-gradient(transparent 60%, black 61%);
            mask: radial-gradient(transparent 60%, black 61%);
            cursor: crosshair;
        }
        /* 内側の選択エリアを「彩度・明度」の2次元選択パネルに変更 */
        .color-lightness-disc {
            position: absolute; top: 25%; left: 25%; width: 50%; height: 50%;
            border-radius: 4px; /* 四角形の方が彩度・明度を選びやすいため */
            background: linear-gradient(to top, #000, transparent), linear-gradient(to right, #fff, transparent);
            background-color: red; /* JavaScriptで動的に変更 */
            cursor: crosshair;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
        }
        /* カラーピッカーのポインター（白抜きの円） */
        .picker-pointer {
            position: absolute;
            width: 20px;
            height: 20px;
            border: 2px solid #fff;
            border-radius: 50%;
            background: transparent;
            box-shadow: 0 0 5px rgba(0,0,0,0.5);
            pointer-events: none; /* ポインター自体がタッチを邪魔しないようにする */
            z-index: 10;
            transform: translate(-50%, -50%); /* 中心をタッチ位置に合わせる */
            will-change: top, left;
            transform: translate(-50%, -50%);
        }
        .color-preview-box {
            width: 60px; height: 60px; border-radius: 50%; border: 2px solid #fff;
            margin-bottom: 20px; background-color: #fff;
        }
        .close-color-btn {
            padding: 10px 40px; border: 1px solid #fff; background: transparent; color: #fff;
            font-family: var(--font-main); font-size: 1rem; cursor: pointer; letter-spacing: 0.1em;
        }
        /* --- 追加：カラーピッカーのポインター（カーソル） --- */
        .picker-pointer {
            position: absolute;
            width: 16px;
            height: 16px;
            border: 2px solid #fff;
            border-radius: 50%;
            background: transparent;
            box-shadow: 0 0 4px rgba(0,0,0,0.5);
            pointer-events: none; /* クリックの邪魔をしない */
            z-index: 10;
            transform: translate(-50%, -50%); /* 中心を合わせる */
        }

        .centered-group { text-align: center; }
        .centered-group input[type="text"], .centered-group input[type="number"] { text-align: center; }
        .input-label-center { display: block; margin-bottom: 20px; font-size: 1.1rem; text-align: center; }

        .input-group { margin-bottom: 70px; }
        .slider-labels { display: flex; justify-content: space-between; margin-bottom: 10px; height: 1.2rem; }
        .lbl-item { 
            text-align: center; width: 80px; font-size: 0.75rem; color: #999; transition: 0.4s; 
            display: flex; justify-content: center; align-items: center;
        }
        .lbl-item.active { color: #fff; font-weight: bold; }

        .slider-wrapper { position: relative; width: 100%; height: 35px; display: flex; align-items: center; }
        .visual-track { position: absolute; width: calc(100% - 24px); left: 12px; height: 1px; background: #222; display: flex; justify-content: space-between; z-index: 1; }
        .track-dot { width: 5px; height: 5px; border-radius: 50%; background: #000; border: 1px solid #333; transform: translateY(-35%); }
        
        input[type=range] { 
            -webkit-appearance: none; width: 100%; background: transparent; z-index: 2; cursor: pointer; margin: 0;
            --thumb-x: 50%; --thumb-y: 50%;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none; height: 26px; width: 26px; border-radius: 50%;
            background-image: url('/static/texture.jpg'); 
            background-size: 1000%; background-position: var(--thumb-x) var(--thumb-y);
            border: 1px solid #fff; transition: transform 0.1s;
        }
        input[type=range]:active::-webkit-slider-thumb { transform: scale(1.2); }

        .title-section {
            text-align: center; margin: 120px 0 80px;
            border-bottom: 1px solid #fff; padding-bottom: 20px;
            width: 80%; margin-left: auto; margin-right: auto;
        }
        /* セクション内のサブ見出しスタイル */
        .section-sub {
            display: block;
            font-size: 0.8rem;
            color: #fff;
            margin-top: 10px;
            letter-spacing: 0.1em;
            font-weight: normal;
        }
        .main-title-jp { font-size: 1.4rem; letter-spacing: 0.15em; margin-bottom: 10px; color: #fff; }
        .main-title-en { font-size: 1.2rem; letter-spacing: 0.05em; color: #ccc; font-family: serif; }

        .section-header { text-align: center; margin: 100px 0 50px; }
        .section-header h2 { font-size: 1.8rem; letter-spacing: 0.4em; margin: 0; color: #fff; }
        .section-header .sub { font-size: 0.8rem; color: #777; letter-spacing: 0.1em; margin-top: 8px; display: block; font-family: sans-serif; }
        /* --- 修正：区切り線の位置調整 --- */
        .section-divider {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            margin: 80px 0;
            color: #444;
            /* letter-spacingを消すか、同じ分量だけtext-indentを入れると中央になります */
            letter-spacing: 0.5em;
            text-indent: 0.5em; 
            font-size: 1.5rem;
            text-align: center;
        }

        #entry-warning {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.9); z-index: 800;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            opacity: 0; visibility: hidden; pointer-events: none;
            transition: opacity 0.8s ease, visibility 0.8s ease; 
            padding: 20px;
        }
        #entry-warning.show { opacity: 1; visibility: visible; pointer-events: auto; }
        .warning-content {
            max-width: 600px; width: 100%;
            color: #ddd; font-size: 0.9rem; line-height: 2.2; text-align: center;
            max-height: 80vh; overflow-y: auto; padding: 20px;
        }
        .warning-content p { margin-bottom: 20px; }

        /* ローディング */
        #loading-overlay { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 999; 
            display: none; flex-direction: column; justify-content: center; align-items: center; padding: 40px; 
        }
        .loading-content-box {
            width: 100%; max-width: 600px; min-height: 300px;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            cursor: pointer; position: relative;
        }
        .loading-text-wrapper { margin-bottom: 30px; text-align: justify; }
        .loading-text-wrapper h4 {
            color: #fff; font-size: 1.4rem; letter-spacing: 0.2em; text-align: center; margin-bottom: 20px;
            background-image: url('/static/texture.jpg'); -webkit-background-clip: text; color: transparent;
            background-size: 1000%;
        }
        .loading-text-wrapper p { color: #ccc; font-size: 0.95rem; line-height: 2.2; }
        .loading-progress-bar { width: 100%; height: 2px; background: #333; margin-top: 20px; position: relative; }
        .bar-inner { position: absolute; left: 0; top: 0; height: 100%; background: #fff; width: 0%; transition: width 0.1s linear; }
        .bar-anim { animation: growBar 20s linear forwards; }
        @keyframes growBar { from { width: 0%; } to { width: 100%; } }
        .tap-hint { margin-top: 10px; font-size: 0.7rem; color: #888; align-self: flex-end; animation: blink 2s infinite; }
        @keyframes blink { 0%, 100% { opacity: 0.4; } 50% { opacity: 1; } }

        .btn-back-top {
            margin-top: 40px; border: 1px solid #444; background: transparent; color: #888;
            padding: 10px 20px; font-size: 0.75rem; cursor: pointer; transition: 0.3s;
        }
        .btn-back-top:hover { border-color: #fff; color: #fff; }

        .qr-section { border: 1px solid #222; padding: 40px; text-align: center; margin: 80px 0; background: rgba(0,0,0,0.5); }
        .qr-section label { display: block; width: 100%; margin-bottom: 20px; font-size: 1rem; }
        
        #qrcode, #qrcode-about, #qrcode-loading { 
            background: #000; padding: 10px; display: inline-block; border: 1px solid #333; 
        }
        .received-thumb { max-width: 100%; border: 1px solid #fff; margin-top: 25px; display: none; }

        .hidden { display: none !important; }
        .lang-jp .lang-en { display: none; }
        .lang-en .lang-jp { display: none; }
        
        /* 英語モード時のメニューサブタイトル */
        .lang-en .menu-sub.lang-jp { display: none; }
    </style>
</head>
<body class="lang-jp">

    <video autoplay muted loop playsinline id="bg-video"><source src="/static/DAMN2.m4v" type="video/mp4"></video>
    <div class="video-overlay"></div>

    <div class="header-fixed">
        <div class="header-left">
            <button onclick="backToTitle()" id="btn-back" class="hidden" style="background:none; border:none; color:#fff; cursor:pointer; font-size:1.8rem;">←</button>
        </div>
        <div class="header-center">
            <h1 class="header-title"><span class="text-marbling">Karma Portrait</span></h1>
        </div>
        <div class="header-right">
            <div class="lang-switch-wrapper" onclick="toggleLanguage()">
                <div id="lang-part-jp" class="lang-part active random-bg">JP</div>
                <div id="lang-part-en" class="lang-part random-bg">EN</div>
            </div>
            <div class="hamburger" onclick="toggleMenu()"><span></span><span></span><span></span></div>
        </div>
    </div>

    <div id="menu-overlay">
        <ul class="menu-list">
            <li><div class="menu-item text-marbling" onclick="menuAction('concept', this)">Concept<span class="menu-sub lang-jp">コンセプト</span><span class="menu-sub lang-en">Core idea</span></div></li>
            <li><div class="menu-item text-marbling" onclick="menuAction('explanation', this)">Explanation<span class="menu-sub lang-jp">作品＆用語解説</span><span class="menu-sub lang-en">Guide & key terms</span></div></li>
            <li><div class="menu-item text-marbling" onclick="menuAction('spoiler', this)">Background<span class="menu-sub lang-jp">背景設定（ネタバレ）</span><span class="menu-sub lang-en">Story (spoilers)</span></div></li>
            <li><div class="menu-item text-marbling" onclick="menuAction('about', this)">About Us<span class="menu-sub lang-jp">プロジェクト紹介</span><span class="menu-sub lang-en">Project & team</span></div></li>
        </ul>
    </div>

    <div id="content-overlay">
        <button onclick="closeContentToMenu()" class="close-content-btn">×</button>
        
        <div id="content-body-concept" class="content-body hidden">
            <h3 class="text-marbling">Concept
                <span class="section-sub lang-jp">コンセプト</span>
                <span class="section-sub lang-en">Core idea</span>
            </h3>
            <h4 class="lang-jp">量子庵 : 演算する彼岸∽二〇卌五</h4>
            <h4 class="lang-en">2〇45: A Quantum Hermitage</h4>
            <p class="lang-jp">二畳の茶室「量子庵」の掛軸型モニターは、此岸と彼岸のあわいに口をひらくポータルとして機能する。鑑賞者が記憶や選択を奉納すると、AIは人間には辿り着けない計算の暗がりで仮想浄土を構築し、その内部に一度きりの記号的自己像〈Karma Portrait〉を刻む。そこに立ち上がるのは、言語化以前に身体が抱え込んだ感情や欲望が、光とノイズのうねりとして析出した風景であり、観る者はアイデンティティという記号をいったん手放し、その像に自らの「どこへ還るか」という感覚を静かに促す。</p>
            <p class="lang-en">In the two-mat tea room "Ryoshi-an," a hanging-scroll–shaped monitor functions as a portal opening between this shore and the other. When a viewer offers memories and choices, AI constructs a virtual Pure Land within the computational darkness humans cannot traverse, inscribing within it a one-time semiotic self-image: "Karma Portrait." What emerges is a landscape where emotions and desires—held by the body prior to language—precipitate as swells of light and noise. The viewer is invited to relinquish the sign called "identity" and to let the image quietly prompt a sense of "where one returns."</p>
            
            <h4 class="lang-jp">Exhibition Mode:</h4><h4 class="lang-en">Exhibition Mode:</h4>
            <p class="lang-jp">量子庵の掛軸に、常設のループ映像が静かに流れ続けるモードである。入力は必要ない。空間は待ち、光は呼吸し、仮想浄土の“気配”だけが反復される。ここでは作品は説明をしない。鑑賞者が「見る」前に、まず「暗さに馴染む」ことが優先される。</p>
            <p class="lang-en">Exhibition Mode sustains a permanent loop on the scroll of Ryoshi-an. No input is required. The space waits, light breathes, and only the "presence" of the virtual Pure Land is reiterated. Here, the work offers no explanation. Before "looking," priority is given to the viewer becoming acclimated to the darkness.</p>
            
            <h4 class="lang-jp">Interactive Mode:</h4><h4 class="lang-en">Interactive Mode:</h4>
            <p class="lang-jp">鑑賞者の奉納によって、仮想浄土がその場で再構成されるモードである。入力された断片は、計算の暗がりへ落ち、手順の代わりに結果として戻ってくる。その結果が、Karma Portraitとして一度だけ像を結ぶ。体験は参加ではなく照合である――自分の記号を一度手放し、像に「どこへ還るか」の感覚をそっと重ねるための時間になる。</p>
            <p class="lang-en">Interactive Mode reconfigures the virtual Pure Land on the spot through the viewer’s offering. Submitted fragments fall into computational obscurity and return not as a procedure, but as a result. This result coheres, just once, as a Karma Portrait. The experience is not participation, but verification—a time to release one’s semiotic self and gently overlay the sense of "where one returns" onto the image.</p>
        </div>
        
        <div id="content-body-explanation" class="content-body hidden">
            <h3 class="text-marbling">Explanation
                <span class="section-sub lang-jp">作品＆用語解説</span>
                <span class="section-sub lang-en">Guide & key terms</span>
            </h3>
            <h4 class="lang-jp">量子庵</h4><h4 class="lang-en">Ryoshi-an</h4>
            <p class="lang-jp">二畳という最小の器に、最大の遠さを折り畳むための名である。量子とは、世界が連続ではなく、跳躍と確率で編まれているという感触の別名だ。量子庵は、過剰な情報から距離を取り、むしろ「演算だけが届く彼岸」を迎え入れるための暗室として設計される。光が少ないほど、像は強くなる。静けさが深いほど、閾値は薄くなる。</p>
            <p class="lang-en">A name for folding maximal distance into the minimal vessel of a two-mat room. "Quantum" is another name for the intuition that the world is woven not from continuity, but from leaps and probabilities. Ryoshi-an is designed as a darkroom to withdraw from information saturation and instead welcome the "other shore where only computation can reach." The less light there is, the stronger the image becomes. The deeper the silence, the thinner the threshold.</p>
            <h4 class="lang-jp">Karma Portrait</h4><h4 class="lang-en">Karma Portrait</h4>
            <p class="lang-jp">これは“顔”ではない。自己の似姿でもない。鑑賞者が差し出す記憶や選択は、人格の説明ではなく、業としての偏りとして扱われる。Karma Portraitは、その偏りが映像の秩序へと翻訳された、一度きりの記号的自己像である。言語化以前に身体が抱え込んだ輪郭が、光とノイズのうねりとして析出し、像になる。</p>
            <p class="lang-en">This is not a "face," nor is it a likeness of the self. The memories and choices offered by the viewer are treated not as a psychological profile, but as karmic bias. Karma Portrait is a one-time semiotic self-image produced when that bias is translated into the order of the moving image. Contours held by the body before language condense as swells of light and noise, manifesting as an image.</p>
            <h4 class="lang-jp">演算する彼岸</h4><h4 class="lang-en">The Computed Higan</h4>
            <p class="lang-jp">彼岸は、本来「向こう側」ではなく、「到達の形式」そのものかもしれない。人間の理解が追いつかない速度で、しかし確かに“答え”だけは生成される。そうした計算の暗がりに、彼岸を仮置きする。ここで演算は、意味を説明するためではなく、説明不能なまま成立してしまう事実を提示するために働く。鑑賞者は理解ではなく、適合でそれに触れる。</p>
            <p class="lang-en">Higan (the other shore) may not be a "place over there," but rather the "mode of arrival" itself. Answers are generated at velocities beyond human comprehension, yet they undeniably exist as "answers." In this computational obscurity, we provisionally place Higan. Here, computation does not explain meaning, but presents a fact that stands despite being inexplicable. The viewer encounters it not through understanding, but through fit.</p>
            <h4 class="lang-jp">二〇卌五</h4><h4 class="lang-en">二〇卌五 (2〇45)</h4>
            <p class="lang-jp">二〇卌五は、ひとつの記法である。二〇二五の「二」に棒を二本足して「卌（40）」とし、2025と2045を一本の線でつなぐ。「人間が追えない計算」が常態化し、結果だけが日常へ降りてくる地点。そこでは、正しさの証明は人間の手を離れ、受け取ることだけが残る。シンギュラリティが“遠い未来”として語られる一方で、その影はすでに現在の延長上に差している。</p>
            <p class="lang-en">二〇卌五 is a notation, not just a date. By adding two strokes to the "二" (two) of 2025, it becomes "卌" (forty), linking 2025 and 2045 as a single line. It marks the point where "computation humans cannot follow" becomes ordinary, and only the results descend into daily life. Proof of truth detaches from human hands, leaving only reception. While singularity is spoken of as a "distant future," its shadow is already cast upon the extension of the present.</p>
        </div>

        <div id="content-body-spoiler" class="content-body hidden">
            <h3 class="text-marbling">Background
                <span class="section-sub lang-jp">背景設定（ネタバレ）</span>
                <span class="section-sub lang-en">Story (spoilers)</span>
            </h3>
            <p class="lang-jp">量子コンピュータとAIシンギュラリティが常態化した二〇卌五年、人類はひとつの「結論」を受け取る。それは、誰も望まなかった形で、しかも誰も否定できない形で提示された。</p>
            <p class="lang-en">In 2○45, where quantum computing and AI singularity have become the norm, humanity receives a certain "conclusion." It was presented in a form no one desired, yet no one could deny.</p>
            <p class="lang-jp">量子AIは、人間の論理が届かない演算の暗がりから、矛盾なく閉じた答えを返した――「死後の世界は存在する。そして、その輪郭は“現在の生き様”から推察できる」。</p>
            <p class="lang-en">From the computational darkness where human logic fails to reach, Quantum AI returned a perfectly consistent answer: "The afterlife exists. And its contours can be inferred from your 'current way of life'."</p>
            <p class="lang-jp">人々は当然、信じなかった。けれどその答えは、バックアップされた同型のシステムでも、並列化された別系統の計算機でも、検証試行を重ねるほどに整合してしまう。反例が立たないのではなく、反例を立てるための人間側の手続きが、計算世界の複雑さに追いつかない。</p>
            <p class="lang-en">Naturally, people did not believe it. However, the more they tested it across mirrored systems or parallelized machines, the answer remained consistent. It wasn't that a counter-example couldn't exist; it was that the human procedure for establishing one could no longer keep pace with the computational world's complexity.</p>
            <p class="lang-jp">それは、円周率の「最後」を見せられたのに似ている。ラストの一万桁が出力されても、こちらにはそれを“最後だと証明する言葉”がない。あるいは、天気を完全に予報できないまま予報だけを使い、スマホの全構造を書き起こせないまま道具として扱い、暗号を解けないまま真偽を受け入れるのと同じだ。人間の理解は遅れ、しかし結果だけが先に日常へ降りてくる。ここに、人類の分岐点がある。</p>
            <p class="lang-en">It is like being shown the "end" of Pi. Even if the final digits were output, we lack the language to prove it is the end. We use forecasts we cannot compute, and devices we cannot map. Human understanding is delayed, yet results descend into daily life first. This is the bifurcation point of humanity.</p>
            <p class="lang-jp">さらに不穏なのは、その「死後の世界」の観測像が、宗教的寓話ではなく、仏教的な“浄土”の位相に異様なほど近いことだった。救いをそこに見出し、肉体の外へ移住することを目的にする個は現れる。だが、集団としての合意はまだ形成されない。世界は揺れているのに、共同体の輪郭だけが定まらない――それが二〇卌五年の空気である。</p>
            <p class="lang-en">What is more unsettling is that the observed image of this "afterlife" was uncannily close to the Buddhist "Pure Land." Some seek migration beyond the flesh, yet collective consensus fails to form. The world is trembling, yet the community's outline remains unfixed—this is the atmosphere of 2○45.</p>
            <p class="lang-jp">量子庵は、その未来の一断面を、二〇二五年へ折り畳む装置だ。二畳の茶室という最小の器に、最大の遠さを招き入れる。鑑賞者が記憶や選択を奉納すると、量子庵はそれらを人格の説明としてではなく、業（カルマ）としての偏りとして読み替える。</p>
            <p class="lang-en">Ryoshi-an is a device that folds a cross-section of that future into 2025. When a viewer offers memories or choices, Ryoshi-an interprets them not as a description of personality, but as karmic bias (Karma).</p>
            <p class="lang-jp">AIが構築するのは、理解のための物語ではない。説明不能なまま成立してしまう事実を、光とノイズのうねりとして立ち上げる仮想浄土である。そこに刻まれるのが、一度きりの記号的自己像――〈Karma Portrait〉。それは“顔”ではなく、似姿でもない。言語化以前に身体が抱え込んだ感情や欲望、回避と執着の癖が、像の秩序へ翻訳された痕跡だ。</p>
            <p class="lang-en">AI manifests a virtual Pure Land—a fact that exists despite being inexplicable—as a swell of light and noise. What is inscribed is a one-time semiotic self-image: Karma Portrait. It is not a "face," but a trace of emotions and desires held by the body, translated into the order of the image.</p>
            <p class="lang-jp">鑑賞者は、アイデンティティという記号をいったん手放す。そして、掛軸型モニターの前で、自分に問われる。「どこへ還るか」ではなく、「どこへ還ってしまうのか」。量子庵が差し出すのは答えではない。答え“だけ”が存在してしまう時代の、受け取り方そのものだ。</p>
            <p class="lang-en">The viewer temporarily relinquishes identity. Before the monitor, they are asked: Not "Where will I return?" but "Where will I end up returning?" Ryoshi-an offers not an answer, but the very method of reception in an era where "only" the answer exists.</p>
        </div>
        <div id="content-body-about" class="content-body hidden" style="text-align:center;">
            <h3 class="text-marbling">About Us
                <span class="section-sub lang-jp">プロジェクト紹介</span>
                <span class="section-sub lang-en">Project & team</span>
            </h3>

            <p style="margin-top: 40px; font-size: 1.1rem; letter-spacing: 0.05em;">We are GOKURAKU FINE ARTS.</p>
    
            <!-- ロゴ画像 -->
            <div style="margin: 50px auto;">
                <img src="/static/logo.PNG" alt="GOKURAKU FINE ARTS" style="max-width: 200px; height: auto;">
            </div>

            <p style="font-size:0.8rem; color:#888; margin-top:40px;">Concept, Art Direction & Spatial Design</p>
            <p style="margin-bottom:30px; font-size:1.2rem;">Yuna Sakai</p>
            <p style="font-size:0.8rem; color:#888;">Technical Direction, System Architecture & UI/UX Design</p>
            <p style="font-size:1.2rem;">Haruto Kume</p>
            <div style="margin-top:60px; padding-top:40px; border-top:1px solid #222;">
                <p style="font-size:0.75rem; color:#666;">Scan for Info (Mobile)</p>
                <div id="qrcode-about" style="background:#000; padding:10px; display:inline-block; margin-top:10px;"></div>
            </div>
            <p style="margin-top:40px; font-size:0.7rem; color:#444;">© GOKURAKU FINE ARTS</p>
        </div>
    </div>

    <div id="entry-warning">
        <div class="warning-content">
            <p class="lang-jp">
                ここで差し出すのは、正解ではなく、手がかりです。<br>
                すべてに答える必要はありません。答えられる範囲だけで構いません。<br>
                けれど、選択と言葉が多いほど、〈Karma Portrait〉はあなたの輪郭に近づきます。<br><br>
                生成にかかる時間は、時刻と回線の混み具合に揺れます。<br>
                早いときも、遅いときもあります。<br><br>
                安全のため、クレジットカード番号やパスワードなどの重要な個人情報は入力しないでください。<br>
                ここに残るのは、映像を組み上げるための最小限の痕跡です。
            </p>
            <p class="lang-en">
                What you leave here is not an answer, but a cue.<br>
                You don’t need to respond to everything—only what you can.<br>
                The more you offer, the more closely your 〈Karma Portrait〉 can approach your outline.<br><br>
                Generation time may shift with the hour and network congestion.<br>
                Sometimes it is quick; sometimes it takes longer.<br><br>
                For your safety, please do not enter sensitive personal information such as credit card details or passwords.<br>
                What remains here is only a minimal trace used to assemble the visuals.
            </p>
        </div>
        <button class="btn-entry" style="margin-top:20px; max-width:280px;" onclick="proceedToForm()">Proceed</button>
    </div>

    <div class="container">
        <div id="landing-page">
            <div style="height: 5vh;"></div>
            <div class="title-section">
                <div class="main-title-jp text-marbling lang-jp">量子庵 : 演算する彼岸∽二〇卌五</div>
                <div class="main-title-jp text-marbling lang-en">2○45: A Quantum Hermitage</div>
            </div>
            <div style="text-align: center; line-height: 2.3; font-size: 0.95rem; margin-bottom: 60px; color:#ccc;">
                <p class="lang-jp">
                    二畳の茶室「量子庵」の掛軸型モニターは、<br>
                    此岸と彼岸のあわいにひらく小さな境界です。<br><br>
                    ここで入力される言葉と選択は、<br>
                    あなたの内側に沈んでいる記憶や癖<br>
                    （まだ説明になりきらない部分）を<br>
                    拾い上げるための、最小限の手がかりになります。<br><br>
                    送信された内容は、そのまま「答え」として保存されるのではなく、<br>
                    ひとつの輪廻として再編成されます。<br><br>
                    AIは人間には辿り着けない計算の暗がりで仮想浄土を組み上げ、<br>
                    その内部に一度きりの『Karma Portrait』を刻みます。<br><br>
                    掛軸に現れるのは、あなたの「情報」ではなく、<br>
                    言語化以前に身体が抱え込んだ感情や欲望が、<br>
                    光とノイズとして析出した風景です。
                </p>
                <p class="lang-en">
                    The hanging scroll monitor in the tea room "Ryoshi-an"<br>
                    is a small boundary opening between this world and the other.<br><br>
                    The words and choices you enter here are minimal clues<br>
                    to pick up the memories and habits sunk deep inside you<br>
                    —the parts that haven't yet become an explanation.<br><br>
                    The submitted content is reorganized as a cycle of reincarnation.<br>
                    AI constructs a virtual Pure Land in a computational darkness<br>
                    that humans cannot reach, and inscribes within it<br>
                    a one-time "Karma Portrait."
                </p>
            </div>
            <button class="btn-entry" onclick="goToForm(this)">Entry</button>
        </div>

        <div id="form-page" class="hidden">
            <div class="section-header" style="margin-bottom:30px; margin-top:50px;">
                <h2 style="font-size:1.2rem;"><span class="lang-jp">ニックネーム</span><span class="lang-en">Nickname</span></h2>
            </div>
            <div class="input-group centered-group">
                <input type="text" id="q1" class="clean-input">
            </div>

            <div class="section-header" style="margin-bottom:30px;">
                <h2 style="font-size:1.2rem;"><span class="lang-jp">年齢</span><span class="lang-en">Age</span></h2>
            </div>
            <div class="input-group centered-group">
                <input type="number" id="q2" class="clean-input" inputmode="numeric">
            </div>

            <div class="section-header" style="margin-bottom:30px;">
                <h2 style="font-size:1.2rem;"><span class="lang-jp">好きな色</span><span class="lang-en">Favorite Color</span></h2>
            </div>
            <div class="input-group centered-group">
                <input type="hidden" id="q3">
                <div class="color-picker-trigger" id="color-trigger" onclick="openColorPicker()">タップして色を選択…</div>
            </div>

            <div class="section-header" style="margin-bottom:30px;">
                <h2 style="font-size:1.2rem;"><span class="lang-jp">過ごすなら</span><span class="lang-en">Conditions</span></h2>
            </div>
            <div class="input-group">
                <div class="slider-labels" id="labels-q4_1">
                    <div class="lbl-item"><span class="lang-jp">明方</span><span class="lang-en">Dawn</span></div>
                    <div class="lbl-item"><span class="lang-jp">昼</span><span class="lang-en">Day</span></div>
                    <div class="lbl-item"><span class="lang-jp">夕方</span><span class="lang-en">Dusk</span></div>
                    <div class="lbl-item"><span class="lang-jp">夜</span><span class="lang-en">Night</span></div>
                </div>
                <div class="slider-wrapper"><div class="visual-track"><div class="track-dot"></div><div class="track-dot"></div><div class="track-dot"></div><div class="track-dot"></div></div><input type="range" id="q4_1" min="0" max="3" value="0" step="1" oninput="updLbl(this,'labels-q4_1')"></div>
            </div>
            <div class="input-group">
                <div class="slider-labels" id="labels-q4_2">
                    <div class="lbl-item"><span class="lang-jp">晴天</span><span class="lang-en">Sun</span></div>
                    <div class="lbl-item"><span class="lang-jp">曇天</span><span class="lang-en">Cloud</span></div>
                    <div class="lbl-item"><span class="lang-jp">雨天</span><span class="lang-en">Rain</span></div>
                    <div class="lbl-item"><span class="lang-jp">雷光</span><span class="lang-en">Lightn</span></div>
                    <div class="lbl-item"><span class="lang-jp">星空</span><span class="lang-en">Stars</span></div>
                </div>
                <div class="slider-wrapper"><div class="visual-track"><div class="track-dot"></div><div class="track-dot"></div><div class="track-dot"></div><div class="track-dot"></div><div class="track-dot"></div></div><input type="range" id="q4_2" min="0" max="4" value="0" step="1" oninput="updLbl(this,'labels-q4_2')"></div>
            </div>
            <div class="input-group">
                <div class="slider-labels" id="labels-q4_3">
                    <div class="lbl-item"><span class="lang-jp">春</span><span class="lang-en">Spring</span></div>
                    <div class="lbl-item"><span class="lang-jp">夏</span><span class="lang-en">Summer</span></div>
                    <div class="lbl-item"><span class="lang-jp">秋</span><span class="lang-en">Autumn</span></div>
                    <div class="lbl-item"><span class="lang-jp">冬</span><span class="lang-en">Winter</span></div>
                </div>
                <div class="slider-wrapper"><div class="visual-track"><div class="track-dot"></div><div class="track-dot"></div><div class="track-dot"></div><div class="track-dot"></div></div><input type="range" id="q4_3" min="0" max="3" value="0" step="1" oninput="updLbl(this,'labels-q4_3')"></div>
            </div>

            <div class="section-divider">⸻</div>
            
            <div class="section-header" style="margin-bottom:30px;">
                <h2 style="font-size:1.2rem;"><span class="lang-jp">行動</span><span class="lang-en">Approach</span></h2>
            </div>
            <div class="input-group">
                <div class="slider-labels" id="labels-q5">
                    <div class="lbl-item"><span class="lang-jp">流れに乗る</span><span class="lang-en">Passive</span></div>
                    <div class="lbl-item"><span></span></div>
                    <div class="lbl-item"><span></span></div>
                    <div class="lbl-item"><span></span></div>
                    <div class="lbl-item"><span class="lang-jp">流れを動かす</span><span class="lang-en">Active</span></div>
                </div>
                <div class="slider-wrapper"><div class="visual-track"><div class="track-dot"></div><div class="track-dot"></div><div class="track-dot"></div><div class="track-dot"></div><div class="track-dot"></div></div><input type="range" id="q5" min="0" max="4" value="0" step="1" oninput="updLbl(this,'labels-q5')"></div>
            </div>

            <div class="section-header" style="margin-bottom:30px;">
                <h2 style="font-size:1.2rem;"><span class="lang-jp">住処</span><span class="lang-en">Environment</span></h2>
            </div>
            <div class="input-group">
                <div class="slider-labels" id="labels-q6_1">
                    <div class="lbl-item"><span class="lang-jp">都市</span><span class="lang-en">Urban</span></div>
                    <div class="lbl-item"><span></span></div>
                    <div class="lbl-item"><span></span></div>
                    <div class="lbl-item"><span></span></div>
                    <div class="lbl-item"><span class="lang-jp">田舎</span><span class="lang-en">Rural</span></div>
                </div>
                <div class="slider-wrapper"><div class="visual-track"><div class="track-dot"></div><div class="track-dot"></div><div class="track-dot"></div><div class="track-dot"></div><div class="track-dot"></div></div><input type="range" id="q6_1" min="0" max="4" value="0" step="1" oninput="updLbl(this,'labels-q6_1')"></div>
            </div>
            <div class="input-group">
                <div class="slider-labels" id="labels-q6_2">
                    <div class="lbl-item"><span class="lang-jp">喧騒</span><span class="lang-en">Hectic</span></div>
                    <div class="lbl-item"><span></span></div>
                    <div class="lbl-item"><span></span></div>
                    <div class="lbl-item"><span></span></div>
                    <div class="lbl-item"><span class="lang-jp">静寂</span><span class="lang-en">Calm</span></div>
                </div>
                <div class="slider-wrapper"><div class="visual-track"><div class="track-dot"></div><div class="track-dot"></div><div class="track-dot"></div><div class="track-dot"></div><div class="track-dot"></div></div><input type="range" id="q6_2" min="0" max="4" value="0" step="1" oninput="updLbl(this,'labels-q6_2')"></div>
            </div>
            <div class="input-group">
                <div class="slider-labels" id="labels-q6_3">
                    <div class="lbl-item"><span class="lang-jp">現実</span><span class="lang-en">Real</span></div>
                    <div class="lbl-item"><span></span></div>
                    <div class="lbl-item"><span></span></div>
                    <div class="lbl-item"><span></span></div>
                    <div class="lbl-item"><span class="lang-jp">夢想</span><span class="lang-en">Dreamlike</span></div>
                </div>
                <div class="slider-wrapper"><div class="visual-track"><div class="track-dot"></div><div class="track-dot"></div><div class="track-dot"></div><div class="track-dot"></div><div class="track-dot"></div></div><input type="range" id="q6_3" min="0" max="4" value="0" step="1" oninput="updLbl(this,'labels-q6_3')"></div>
            </div>

            <div class="section-header" style="margin-bottom:30px;">
                <h2 style="font-size:1.2rem;"><span class="lang-jp">好きな香り</span><span class="lang-en">Scent</span></h2>
            </div>
            <div class="input-group centered-group">
                <div class="slider-labels" id="labels-q7">
                    <div class="lbl-item"><span class="lang-jp">フローラル</span><span class="lang-en">Floral</span></div>
                    <div class="lbl-item"><span class="lang-jp">フルーティ</span><span class="lang-en">Fruity</span></div>
                    <div class="lbl-item"><span class="lang-jp">ウッディ</span><span class="lang-en">Woody</span></div>
                    <div class="lbl-item"><span class="lang-jp">スパイシー</span><span class="lang-en">Spicy</span></div>
                    <div class="lbl-item"><span class="lang-jp">スモーキー</span><span class="lang-en">Smoky</span></div>
                </div>
                <div class="slider-wrapper"><div class="visual-track"><div class="track-dot"></div><div class="track-dot"></div><div class="track-dot"></div><div class="track-dot"></div><div class="track-dot"></div></div><input type="range" id="q7" min="0" max="4" value="0" step="1" oninput="updLbl(this,'labels-q7')"></div>
            </div>

            <div class="section-divider">⸻</div>

            <div class="section-header" style="margin-bottom:30px;">
                <h2 style="font-size:1.2rem;"><span class="lang-jp">旅行に行くなら</span><span class="lang-en">Destination</span></h2>
            </div>
            <div class="input-group centered-group">
                <input type="text" id="q8" class="clean-input" placeholder="国や都市 / Country or City">
            </div>

            <div class="section-header" style="margin-bottom:30px;">
                <h2 style="font-size:1.2rem;"><span class="lang-jp">願いが向くのは</span><span class="lang-en">Wish Direction</span></h2>
            </div>
            <div class="input-group centered-group">
                <div class="slider-labels" id="labels-q9">
                    <div class="lbl-item"><span class="lang-jp">過去</span><span class="lang-en">Past</span></div>
                    <div class="lbl-item"><span class="lang-jp">現在</span><span class="lang-en">Now</span></div>
                    <div class="lbl-item"><span class="lang-jp">未来</span><span class="lang-en">Future</span></div>
                </div>
                <div class="slider-wrapper"><div class="visual-track"><div class="track-dot"></div><div class="track-dot"></div><div class="track-dot"></div></div><input type="range" id="q9" min="0" max="2" value="0" step="1" oninput="updLbl(this,'labels-q9')"></div>
            </div>

            <div class="section-header" style="margin-bottom:30px;">
                <h2 style="font-size:1.2rem;"><span class="lang-jp">エネルギー源</span><span class="lang-en">Drive</span></h2>
            </div>
            <div class="input-group centered-group">
                <div class="slider-labels" id="labels-q10">
                    <div class="lbl-item"><span class="lang-jp">探求</span><span class="lang-en">Exploration</span></div>
                    <div class="lbl-item"><span></span></div>
                    <div class="lbl-item"><span></span></div>
                    <div class="lbl-item"><span></span></div>
                    <div class="lbl-item"><span class="lang-jp">安全</span><span class="lang-en">Security</span></div>
                </div>
                <div class="slider-wrapper"><div class="visual-track"><div class="track-dot"></div><div class="track-dot"></div><div class="track-dot"></div><div class="track-dot"></div><div class="track-dot"></div></div><input type="range" id="q10" min="0" max="4" value="0" step="1" oninput="updLbl(this,'labels-q10')"></div>
            </div>

            <div class="section-divider">⸻</div>

            <div class="section-header" style="margin-bottom:30px;">
                <h2 style="font-size:1.2rem;"><span class="lang-jp">因果観</span><span class="lang-en">Causality</span></h2>
            </div>
            <div class="input-group centered-group">
                <div class="slider-labels" id="labels-q11">
                    <div class="lbl-item"><span class="lang-jp">因果</span><span class="lang-en">Causal</span></div>
                    <div class="lbl-item"><span></span></div>
                    <div class="lbl-item"><span></span></div>
                    <div class="lbl-item"><span></span></div>
                    <div class="lbl-item"><span class="lang-jp">偶然</span><span class="lang-en">Random</span></div>
                </div>
                <div class="slider-wrapper"><div class="visual-track"><div class="track-dot"></div><div class="track-dot"></div><div class="track-dot"></div><div class="track-dot"></div><div class="track-dot"></div></div><input type="range" id="q11" min="0" max="4" value="0" step="1" oninput="updLbl(this,'labels-q11')"></div>
            </div>

            <div class="section-header" style="margin-bottom:30px;">
                <h2 style="font-size:1.2rem;"><span class="lang-jp">慈悲観</span><span class="lang-en">Compassion</span></h2>
            </div>
            <div class="input-group centered-group">
                <div class="slider-labels" id="labels-q12">
                    <div class="lbl-item"><span class="lang-jp">自身のため</span><span class="lang-en">Self</span></div>
                    <div class="lbl-item"><span></span></div>
                    <div class="lbl-item"><span></span></div>
                    <div class="lbl-item"><span></span></div>
                    <div class="lbl-item"><span class="lang-jp">他者のため</span><span class="lang-en">Others</span></div>
                </div>
                <div class="slider-wrapper"><div class="visual-track"><div class="track-dot"></div><div class="track-dot"></div><div class="track-dot"></div><div class="track-dot"></div><div class="track-dot"></div></div><input type="range" id="q12" min="0" max="4" value="0" step="1" oninput="updLbl(this,'labels-q12')"></div>
            </div>

            <div class="section-header" style="margin-bottom:30px;">
                <h2 style="font-size:1.2rem;"><span class="lang-jp">無常観</span><span class="lang-en">Impermanence</span></h2>
            </div>
            <div class="input-group centered-group">
                <div class="slider-labels" id="labels-q13">
                    <div class="lbl-item"><span class="lang-jp">受け入れる</span><span class="lang-en">Accept</span></div>
                    <div class="lbl-item"><span></span></div>
                    <div class="lbl-item"><span></span></div>
                    <div class="lbl-item"><span></span></div>
                    <div class="lbl-item"><span class="lang-jp">抗う</span><span class="lang-en">Resist</span></div>
                </div>
                <div class="slider-wrapper"><div class="visual-track"><div class="track-dot"></div><div class="track-dot"></div><div class="track-dot"></div><div class="track-dot"></div><div class="track-dot"></div></div><input type="range" id="q13" min="0" max="4" value="0" step="1" oninput="updLbl(this,'labels-q13')"></div>
            </div>

            <div class="section-header" style="margin-bottom:30px;">
                <h2 style="font-size:1.2rem;"><span class="lang-jp">死生観</span><span class="lang-en">Life & Death</span></h2>
            </div>
            <div class="input-group centered-group">
                <div class="slider-labels" id="labels-q14">
                    <div class="lbl-item"><span class="lang-jp">肉体に留まる</span><span class="lang-en">Remain Embodied</span></div>
                    <div class="lbl-item"><span class="lang-jp">オンラインへ移行する</span><span class="lang-en">Go Online</span></div>
                </div>
                <div class="slider-wrapper"><div class="visual-track"><div class="track-dot"></div><div class="track-dot"></div></div><input type="range" id="q14" min="0" max="1" value="0" step="1" oninput="updLbl(this,'labels-q14')"></div>
            </div>

            <div class="section-divider">⸻</div>

            <div class="section-header" style="margin-bottom:30px;">
                <h2 style="font-size:1.2rem;"><span class="lang-jp">向かうなら</span><span class="lang-en">Heading Toward</span></h2>
            </div>
            <div class="input-group centered-group">
                <div class="slider-labels" id="labels-q15">
                    <div class="lbl-item"><span class="lang-jp">北国</span><span class="lang-en">North</span></div>
                    <div class="lbl-item"><span></span></div>
                    <div class="lbl-item"><span></span></div>
                    <div class="lbl-item"><span></span></div>
                    <div class="lbl-item"><span class="lang-jp">南国</span><span class="lang-en">South</span></div>
                </div>
                <div class="slider-wrapper"><div class="visual-track"><div class="track-dot"></div><div class="track-dot"></div><div class="track-dot"></div><div class="track-dot"></div><div class="track-dot"></div></div><input type="range" id="q15" min="0" max="4" value="0" step="1" oninput="updLbl(this,'labels-q15')"></div>
            </div>

            <div class="section-header" style="margin-bottom:30px;">
                <h2 style="font-size:1.2rem;"><span class="lang-jp">還るなら</span><span class="lang-en">Returning to</span></h2>
            </div>
            <div class="input-group centered-group">
                <div class="slider-labels" id="labels-q16">
                    <div class="lbl-item"><span class="lang-jp">深海</span><span class="lang-en">Deep Sea</span></div>
                    <div class="lbl-item"><span class="lang-jp">地中</span><span class="lang-en">Underground</span></div>
                    <div class="lbl-item"><span class="lang-jp">天空</span><span class="lang-en">High Sky</span></div>
                </div>
                <div class="slider-wrapper"><div class="visual-track"><div class="track-dot"></div><div class="track-dot"></div><div class="track-dot"></div></div><input type="range" id="q16" min="0" max="2" value="0" step="1" oninput="updLbl(this,'labels-q16')"></div>
            </div>

            <div class="section-header" style="margin-bottom:30px;">
                <h2 style="font-size:1.2rem;"><span class="lang-jp">ひとつだけ残すなら</span><span class="lang-en">One Thing to Keep</span></h2>
            </div>
            <div class="input-group centered-group">
                <input type="text" id="q17" class="clean-input" placeholder="※短く：1〜3語 推奨 / 1-3 words recommended">
            </div>

            <div class="section-header" style="margin-bottom:30px;">
                <h2 style="font-size:1.2rem;"><span class="lang-jp">好きなもの</span><span class="lang-en">Likes</span></h2>
            </div>
            <div class="input-group centered-group">
                <textarea id="q18" class="clean-textarea" rows="4" placeholder="自由記述（例：海、雨音、ネオン、金属、森 など）/ Free text (e.g., sea, rain, neon, metal, forest)"></textarea>
            </div>

            <div class="section-header" style="margin-bottom:30px;">
                <h2 style="font-size:1.2rem;"><span class="lang-jp">嫌いなもの</span><span class="lang-en">Avoids</span></h2>
            </div>
            <div class="input-group centered-group">
                <textarea id="q19" class="clean-textarea" rows="4" placeholder="自由記述（例：混雑、強い光、騒音、湿気、煙 など）/ Free text (e.g., crowds, harsh light, noise, humidity, smoke)"></textarea>
            </div>

            <div class="qr-section">
                <label class="lang-jp">画像奉納</label><label class="lang-en">Image Offering</label>
                <div id="qrcode"></div>
                <div id="qr-status" style="margin-top:15px; font-size:0.75rem; color:#666;" class="lang-jp">スマホで読み取ってください</div>
                <div id="qr-status-en" style="margin-top:15px; font-size:0.75rem; color:#666;" class="lang-en">Scan with your smartphone</div>
                <img id="received-image" class="received-thumb">
                <button id="reset-img-btn" class="hidden" onclick="resetImage()" style="margin-top:25px; background:none; border:none; color:#fff; border-bottom:1px solid #fff; cursor:pointer; font-size:0.8rem;">× <span class="lang-jp">取り消す</span><span class="lang-en">Cancel</span></button>
            </div>

            <button class="btn-entry" onclick="submitForm(this)">Submit</button>
        </div>
    </div>

    <div id="color-modal">
        <h3 style="color:#fff; margin-bottom:20px; font-weight: normal; letter-spacing: 0.2em;">Select Color</h3>
        <div class="color-picker-wrapper">
            <div class="color-hue-ring" id="color-hue-ring"></div>
            <div id="hue-pointer" class="picker-pointer"></div>
            
            <div class="color-lightness-disc" id="color-lightness-disc">
                <div id="sl-pointer" class="picker-pointer"></div>
            </div>
        </div>
        <div class="color-preview-box" id="color-preview"></div>
        <button class="close-color-btn" onclick="confirmColor()">OK</button>
    </div>

    <div id="loading-overlay">
        <div class="loading-content-box" onclick="nextLoadingTerm()">
            <div class="loading-text-wrapper" id="loading-text-wrapper">
                </div>
            <div class="loading-progress-bar">
                <div class="bar-inner" id="loading-bar"></div>
            </div>
            <div class="tap-hint">
                <span class="lang-jp">タップで次へ ▷</span><span class="lang-en">Tap for next ▷</span>
            </div>
        </div>
        
        <div style="margin-top:40px; text-align:center;">
            <div id="qrcode-loading" style="background:#000; padding:10px; display:inline-block; border:1px solid #333;"></div>
            <p style="margin-top:10px; font-size:0.7rem; color:#888;" class="lang-jp">待ち時間に作品解説を読む</p>
            <p style="margin-top:10px; font-size:0.7rem; color:#888;" class="lang-en">Read documentation while waiting</p>
        </div>
        <button class="btn-back-top" onclick="cancelLoading()">
            <span class="lang-jp">TOPへ戻る</span><span class="lang-en">Back to TOP</span>
        </button>
    </div>

    <script>
        let mySessionId = window.crypto?.randomUUID?.() || "session_" + Date.now();
        let receivedImageBase64 = "";
        let currentLang = 'jp';
        let selectedColorHex = "";
        let isDraggingColor = false;
        let currentHue = 0;
        let currentLightness = 50;
        let curH = 0;
        let curS = 50;
        let curL = 50;
        let isDraggingHue = false;
        let isDraggingSL = false;

        function initColorPickerEvents() {
            const ring = document.getElementById('color-hue-ring');
            const disc = document.getElementById('color-lightness-disc');

            // 共通の座標取得・更新関数
            const handleHue = (e) => {
                const rect = ring.getBoundingClientRect();
                const touch = e.touches ? e.touches[0] : e;
                const x = touch.clientX - (rect.left + rect.width / 2);
                const y = touch.clientY - (rect.top + rect.height / 2);
                let angle = Math.atan2(y, x) * (180 / Math.PI) + 90;
                curH = (angle + 360) % 360;
                applyColor();
                e.preventDefault(); // スクロール防止
            };

            const handleSL = (e) => {
                const rect = disc.getBoundingClientRect();
                const touch = e.touches ? e.touches[0] : e;
                let x = (touch.clientX - rect.left) / rect.width;
                let y = (touch.clientY - rect.top) / rect.height;
                x = Math.max(0, Math.min(1, x));
                y = Math.max(0, Math.min(1, y));
                curS = x * 100;
                curL = (1 - y) * 100;
                applyColor();
                e.preventDefault(); // スクロール防止
            };

            // タッチ開始
            ring.addEventListener('touchstart', (e) => { isDraggingHue = true; handleHue(e); }, {passive: false});
            disc.addEventListener('touchstart', (e) => { isDraggingSL = true; handleSL(e); }, {passive: false});

            // タッチ移動（触れたまま動かす操作）
            window.addEventListener('touchmove', (e) => {
                if (isDraggingHue) handleHue(e);
                if (isDraggingSL) handleSL(e);
            }, {passive: false});

            // タッチ終了
            window.addEventListener('touchend', () => {
                isDraggingHue = false;
                isDraggingSL = false;
            });

            // PCマウス操作用（念のため）
            ring.addEventListener('mousedown', (e) => { isDraggingHue = true; handleHue(e); });
            disc.addEventListener('mousedown', (e) => { isDraggingSL = true; handleSL(e); });
            window.addEventListener('mousemove', (e) => {
                if (isDraggingHue) handleHue(e);
                if (isDraggingSL) handleSL(e);
            });
            window.addEventListener('mouseup', () => {
                isDraggingHue = false;
                isDraggingSL = false;
            });
        }

        function applyColor() {
            const disc = document.getElementById('color-lightness-disc');
            const preview = document.getElementById('color-preview');
            
            // 彩度・明度パネルの背景色を現在の色相にする
            disc.style.backgroundColor = `hsl(${curH}, 100%, 50%)`;
            
            // プレビューの更新
            const color = `hsl(${curH}, ${curS}%, ${curL}%)`;
            preview.style.backgroundColor = color;
            selectedColorHex = rgbToHex(window.getComputedStyle(preview).backgroundColor);

            // ポインターの位置更新（画像に合わせて半径を120に変更）
            const hPointer = document.getElementById('hue-pointer');
            const angleRad = (curH - 90) * (Math.PI / 180);
            const radius = 130; // 円周の真上に乗るように調整
            const centerX = 140; // wrapper(280px)の半分
            const centerY = 140;
            hPointer.style.left = (centerX + radius * Math.cos(angleRad)) + 'px';
            hPointer.style.top = (centerY + radius * Math.sin(angleRad)) + 'px';

            const slPointer = document.getElementById('sl-pointer');
            slPointer.style.left = curS + '%';
            slPointer.style.top = (100 - curL) + '%';
        }

        // 便利な補助関数：RGB文字列をHEXに変換
        function rgbToHex(rgb) {
            const res = rgb.match(/\d+/g);
            return res ? "#" + res.slice(0,3).map(x => parseInt(x).toString(16).padStart(2, '0')).join('') : "#ffffff";
        }

        const loadingContent = [
            {
                title_jp: "量子庵",
                desc_jp: "二畳という最小の器に、最大の遠さを折り畳むための名である。量子とは、世界が連続ではなく、跳躍と確率で編まれているという感触の別名だ。量子庵は、過剰な情報から距離を取り、むしろ「演算だけが届く彼岸」を迎え入れるための暗室として設計される。光が少ないほど、像は強くなる。静けさが深いほど、閾値は薄くなる。",
                title_en: "Ryoshi-an",
                desc_en: "A name for folding maximal distance into the minimal vessel of a two-mat room. \"Quantum\" is another name for the intuition that the world is woven not from continuity, but from leaps and probabilities. Ryoshi-an is designed as a darkroom to withdraw from information saturation and instead welcome the \"other shore where only computation can reach.\" The less light there is, the stronger the image becomes. The deeper the silence, the thinner the threshold."
            },
            {
                title_jp: "Karma Portrait",
                desc_jp: "これは“顔”ではない。自己の似姿でもない。鑑賞者が差し出す記憶や選択は、人格の説明ではなく、業としての偏りとして扱われる。Karma Portraitは、その偏りが映像の秩序へと翻訳された、一度きりの記号的自己像である。言語化以前に身体が抱え込んだ輪郭が、光とノイズのうねりとして析出し、像になる。",
                title_en: "Karma Portrait",
                desc_en: "This is not a \"face,\" nor is it a likeness of the self. The memories and choices offered by the viewer are treated not as a psychological profile, but as karmic bias. Karma Portrait is a one-time semiotic self-image produced when that bias is translated into the order of the moving image. Contours held by the body before language condense as swells of light and noise, manifesting as an image."
            },
            {
                title_jp: "演算する彼岸",
                desc_jp: "彼岸は、本来「向こう側」ではなく、「到達の形式」そのものかもしれない。人間の理解が追いつかない速度で、しかし確かに“答え”だけは生成される。そうした計算の暗がりに、彼岸を仮置きする。ここで演算は、意味を説明するためではなく、説明不能なまま成立してしまう事実を提示するために働く。鑑賞者は理解ではなく、適合でそれに触れる。",
                title_en: "The Computed Higan",
                desc_en: "Higan (the other shore) may not be a \"place over there,\" but rather the \"mode of arrival\" itself. Answers are generated at velocities beyond human comprehension, yet they undeniably exist as \"answers.\" In this computational obscurity, we provisionally place Higan. Here, computation does not explain meaning, but presents a fact that stands despite being inexplicable. The viewer encounters it not through understanding, but through fit."
            },
            {
                title_jp: "二〇卌五",
                desc_jp: "二〇卌五は、ひとつの記法である。二〇二五の「二」に棒を二本足して「卌（40）」とし、2025と2045を一本の線でつなぐ。「人間が追えない計算」が常態化し、結果だけが日常へ降りてくる地点。そこでは、正しさの証明は人間の手を離れ、受け取ることだけが残る。シンギュラリティが“遠い未来”として語られる一方で、その影はすでに現在の延長上に差している。",
                title_en: "二〇卌五 (2○45)",
                desc_en: "二〇卌五 is a notation, not just a date. By adding two strokes to the \"二\" (two) of 2025, it becomes \"卌\" (forty), linking 2025 and 2045 as a single line. It marks the point where \"computation humans cannot follow\" becomes ordinary, and only the results descend into daily life. Proof of truth detaches from human hands, leaving only reception. While singularity is spoken of as a \"distant future,\" its shadow is already cast upon the extension of the present."
            }
        ];

        let loadingIndex = 0;
        let slideTimer;
        let totalTimer;

        document.addEventListener('DOMContentLoaded', () => {
            setLanguage('jp'); connectWebSocket(); generateAboutQR();
            document.querySelectorAll('input[type=range]').forEach(el => {
                if(el.id !== 'lightness-slider') {
                    updLbl(el, 'labels-' + el.id);
                    el.addEventListener('input', (e) => {
                        const rX = Math.floor(Math.random() * 100) + '%';
                        const rY = Math.floor(Math.random() * 100) + '%';
                        e.target.style.setProperty('--thumb-x', rX);
                        e.target.style.setProperty('--thumb-y', rY);
                    });
                    const rX = Math.floor(Math.random() * 100) + '%';
                    const rY = Math.floor(Math.random() * 100) + '%';
                    el.style.setProperty('--thumb-x', rX);
                    el.style.setProperty('--thumb-y', rY);
                }
            });
            initMarbling();
            initColorPickerEvents();
            applyColor();
        });

        function initMarbling() {
            const rX = Math.floor(Math.random() * 100) + '%';
            const rY = Math.floor(Math.random() * 100) + '%';
            document.documentElement.style.setProperty('--rand-x', rX);
            document.documentElement.style.setProperty('--rand-y', rY);
        }

        function connectWebSocket() {
            const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
            const ws = new WebSocket(`${protocol}//${window.location.host}/ws`);
            ws.onmessage = (event) => {
                let data; try { data = JSON.parse(event.data); } catch(e) { return; }
                if (data.type === "satellite_image" && data.session_id === mySessionId) {
                    const thumb = document.getElementById('received-image');
                    thumb.src = "data:image/jpeg;base64," + data.image_data;
                    thumb.style.display = "block";
                    document.getElementById('qrcode').classList.add('hidden');
                    receivedImageBase64 = data.image_data;
                    const status = document.getElementById('qr-status');
                    status.innerText = (currentLang === 'jp') ? "奉納完了" : "Received";
                    status.style.color = "#fff";
                    document.getElementById('reset-img-btn').classList.remove('hidden');
                }
            };
        }

        function updLbl(el, labelId) {
            const container = document.getElementById(labelId);
            if(!container) return;
            const labels = container.querySelectorAll('.lbl-item');
            labels.forEach((l, idx) => l.classList.toggle('active', idx === parseInt(el.value)));
        }

        function openColorPicker() { 
            document.getElementById('color-modal').classList.add('show'); 
            document.body.classList.add('no-scroll'); 
            applyColor();
        }

        function confirmColor() {
            if(selectedColorHex) {
                document.getElementById('q3').value = selectedColorHex;
                const trigger = document.getElementById('color-trigger');
                trigger.innerText = selectedColorHex;
                
                // === 案3: 背景色バッジ化 ===
                // 背景色を選択した色にする
                trigger.style.backgroundColor = selectedColorHex;
                
                // 明度(currentLightness: 0~100) に応じて文字色を白/黒に振り分け
                // 50%より明るい色は黒文字、暗い色は白文字で見やすくする
                trigger.style.color = (currentLightness > 50) ? "#000000" : "#ffffff";
                
                // デザイン調整（バッジ風にするため下線を消して角丸に）
                trigger.style.borderBottom = "none";
                trigger.style.borderRadius = "6px";
                trigger.style.textShadow = "none";
                
                trigger.classList.add('selected');
            }
            document.getElementById('color-modal').classList.remove('show');
            document.body.classList.remove('no-scroll'); 
        }

        function toggleMenu() {
            const menu = document.getElementById('menu-overlay');
            const hamburger = document.querySelector('.hamburger');
            const isOpen = menu.classList.contains('show');
            
            if(isOpen) {
                menu.classList.remove('show');
                hamburger.classList.remove('open');
                document.body.classList.remove('no-scroll');
            } else {
                menu.classList.add('show');
                hamburger.classList.add('open');
                document.body.classList.add('no-scroll');
            }
        }

        function menuAction(action, el) {
            document.querySelectorAll('.menu-item').forEach(m => m.classList.remove('selected'));
            el.classList.add('selected');
            setTimeout(() => { 
                document.getElementById('menu-overlay').classList.remove('show');
                document.querySelector('.hamburger').classList.remove('open');
                showContent(action); 
            }, 200);
        }

        function showContent(type) {
            const overlay = document.getElementById('content-overlay');
            document.querySelectorAll('.content-body').forEach(b => b.classList.add('hidden'));
            document.getElementById('content-body-' + type).classList.remove('hidden');
            overlay.classList.add('show');
            document.body.classList.add('no-scroll');
        }

        function closeContentToMenu() {
            document.getElementById('content-overlay').classList.remove('show');
            document.querySelectorAll('.menu-item').forEach(m => m.classList.remove('selected'));
            document.body.classList.remove('no-scroll');
        }

        function resetView() {
            const form = document.getElementById('form-page');
            const landing = document.getElementById('landing-page');
            form.classList.add('dissolve-out');
            setTimeout(() => {
                form.classList.add('hidden'); form.classList.remove('dissolve-out');
                landing.classList.remove('hidden'); landing.classList.add('dissolve-in');
                document.getElementById('btn-back').classList.add('hidden');
                window.scrollTo(0,0);
                setTimeout(() => landing.classList.remove('dissolve-in'), 800);
            }, 800);
        }

        // goToForm 関数を修正
        function goToForm(btn) {
            btn.classList.add('clicked');
            const landing = document.getElementById('landing-page');
            landing.classList.add('dissolve-out');
            setTimeout(() => {
                landing.classList.add('hidden'); 
                landing.classList.remove('dissolve-out');
                document.getElementById('entry-warning').classList.add('show');
                btn.classList.remove('clicked');
                
                // 追加：ヘッダーの「←」を表示
                document.getElementById('btn-back').classList.remove('hidden');
            }, 800);
        }

        // backToTitle 関数を修正（確認ダイアログ付きでTOPへ）
        function backToTitle() { 
            const msg = (currentLang === 'jp') ? '入力を破棄してTOPに戻りますか？' : 'Discard input and return to TOP?';
            if(confirm(msg)) {
                location.reload(); // 確実にTOP状態に戻すためリロード
            }
        }

        function proceedToForm() {
            const warning = document.getElementById('entry-warning');
            const form = document.getElementById('form-page');
            warning.classList.remove('show');
            setTimeout(() => {
                warning.style.display = 'none'; 
                form.classList.remove('hidden'); form.classList.add('dissolve-in');
                window.scrollTo(0,0); updateQRCode();
                initMarbling();
                setTimeout(() => form.classList.remove('dissolve-in'), 800);
            }, 500);
        }

        function backToTitle() { 
            const msg = (currentLang === 'jp') ? '入力を破棄して戻りますか？' : 'Discard input and return?';
            if(confirm(msg)) location.reload(); 
        }

        function cancelLoading() { location.reload(); }

        function toggleLanguage() { setLanguage(currentLang === 'jp' ? 'en' : 'jp'); }

        function setLanguage(lang) {
            currentLang = lang;
            document.body.className = 'lang-' + lang;
            document.getElementById('lang-part-jp').classList.toggle('active', lang === 'jp');
            document.getElementById('lang-part-en').classList.toggle('active', lang === 'en');
            
            const p_q8_jp = "国や都市";
            const p_q8_en = "Country or City";
            const p_q17_jp = "※短く：1〜3語 推奨";
            const p_q17_en = "1-3 words recommended";
            const p_q18_jp = "自由記述（例：海、雨音、ネオン、金属、森 など）";
            const p_q18_en = "Free text (e.g., sea, rain, neon, metal, forest)";
            const p_q19_jp = "自由記述（例：混雑、強い光、騒音、湿気、煙 など）";
            const p_q19_en = "Free text (e.g., crowds, harsh light, noise, humidity, smoke)";
            
            document.getElementById('q8').placeholder = (lang === 'jp') ? p_q8_jp : p_q8_en;
            document.getElementById('q17').placeholder = (lang === 'jp') ? p_q17_jp : p_q17_en;
            document.getElementById('q18').placeholder = (lang === 'jp') ? p_q18_jp : p_q18_en;
            document.getElementById('q19').placeholder = (lang === 'jp') ? p_q19_jp : p_q19_en;
            
            const colorTrigger = document.getElementById('color-trigger');
            if (!selectedColorHex) {
                colorTrigger.innerText = (lang === 'jp') ? "タップして色を選択…" : "Tap to select color...";
            }

            initMarbling();
            updateQRCode();
            
            if(document.getElementById('loading-overlay').style.display === 'flex') {
                updateLoadingText();
            }
        }

        function generateAboutQR() {
            const container = document.getElementById("qrcode-about");
            container.innerHTML = "";
            new QRCode(container, { 
                text: window.location.origin + "/static/info.html", 
                width: 140, height: 140, 
                colorDark : "#bfbfbf", colorLight : "#000000", correctLevel : QRCode.CorrectLevel.H 
            });
        }

        function updateQRCode() {
            const container = document.getElementById("qrcode");
            container.innerHTML = "";
            const url = `${window.location.origin}/static/upload.html?session_id=${mySessionId}&lang=${currentLang}`;
            new QRCode(container, { 
                text: url, 
                width: 140, height: 140,
                colorDark : "#bfbfbf", colorLight : "#000000", correctLevel : QRCode.CorrectLevel.H
            });
        }

        function resetImage() {
            receivedImageBase64 = "";
            document.getElementById('received-image').style.display = 'none';
            document.getElementById('qrcode').classList.remove('hidden');
            const status = document.getElementById('qr-status');
            status.innerText = (currentLang === 'jp') ? "スマホで読み取ってください" : "Scan with smartphone";
            status.style.color = "#666";
            document.getElementById('reset-img-btn').classList.add('hidden');
        }

        function updateLoadingText() {
            const item = loadingContent[loadingIndex];
            const container = document.getElementById('loading-text-wrapper');

            const rX = Math.floor(Math.random() * 100) + '%';
            const rY = Math.floor(Math.random() * 100) + '%';
            const style = `style="background-position: ${rX} ${rY};"`;

            if(currentLang === 'jp') {
                container.innerHTML = `<h4 ${style}>${item.title_jp}</h4><p>${item.desc_jp}</p>`;
            } else {
                container.innerHTML = `<h4 ${style}>${item.title_en}</h4><p>${item.desc_en}</p>`;
            }
        }

        function nextLoadingTerm() {
            clearInterval(slideTimer);
            loadingIndex = (loadingIndex + 1) % loadingContent.length;
            updateLoadingText();
            resetProgressBar();
            slideTimer = setInterval(autoSlide, 20000);
        }

        function autoSlide() {
            loadingIndex = (loadingIndex + 1) % loadingContent.length;
            updateLoadingText();
            resetProgressBar();
        }

        function resetProgressBar() {
            const bar = document.getElementById('loading-bar');
            bar.classList.remove('bar-anim');
            void bar.offsetWidth; // trigger reflow
            bar.classList.add('bar-anim');
        }

        async function submitForm(btn) {
            if(btn) btn.classList.add('clicked');
            
            const overlay = document.getElementById('loading-overlay');
            overlay.style.display = 'flex';

            const qrLoading = document.getElementById("qrcode-loading");
            qrLoading.innerHTML = "";
            new QRCode(qrLoading, { 
                text: window.location.origin + "/static/info.html", 
                width: 120, height: 120,
                colorDark : "#bfbfbf", colorLight : "#000000", correctLevel : QRCode.CorrectLevel.H
            });

            loadingIndex = 0;
            updateLoadingText();
            resetProgressBar();
            
            slideTimer = setInterval(autoSlide, 20000);
            
            totalTimer = setTimeout(() => location.reload(), 120000);

            const formData = new FormData();
            formData.append('image_b64', receivedImageBase64);
            const ids = ['q1','q2','q3','q4_1','q4_2','q4_3','q5','q6_1','q6_2','q6_3','q7','q8','q9','q10','q11','q12','q13','q14','q15','q16','q17','q18','q19'];
            ids.forEach(id => formData.append(id, document.getElementById(id).value || ""));

            try {
                const res = await fetch('/submit', { method: 'POST', body: formData });
                if(!res.ok) { 
                    alert("Error"); 
                    clearInterval(slideTimer); 
                    clearTimeout(totalTimer);
                    overlay.style.display='none'; 
                    if(btn) btn.classList.remove('clicked'); 
                }
            } catch(e) { 
                clearInterval(slideTimer); 
                clearTimeout(totalTimer);
                overlay.style.display='none'; 
                if(btn) btn.classList.remove('clicked'); 
            }
        }
    </script>
    <div class="footer" style="text-align: center; font-size: 0.7rem; color: #444; margin-top: 40px; padding-bottom: 20px;">
        ©GOKURAKU FINE ARTS
    </div>
</body>
</html>